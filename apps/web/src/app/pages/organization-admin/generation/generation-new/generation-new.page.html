<div class="generation-new-page">
	<p-toolbar>
		<div class="p-toolbar-group-start flex align-items-center gap-3">
			<p-button
				icon="pi pi-arrow-left"
				[text]="true"
				(onClick)="onBack()"
			/>
			<h2 class="m-0">New Generation Request</h2>
		</div>
	</p-toolbar>

	<div class="p-4">
		<div class="surface-card border-round p-4">
			<!-- Brief -->
			<div class="field mb-4">
				<label for="brief" class="block font-semibold mb-2"
					>Brief *</label
				>
				<textarea
					pTextarea
					id="brief"
					[(ngModel)]="brief"
					rows="4"
					class="w-full"
					placeholder="Describe the image you want to generate..."
				></textarea>
				<small class="text-color-secondary"
					>Describe the product, scene, or concept for the AI to
					generate.</small
				>
			</div>

			<!-- Initial Prompt (Optional) -->
			<div class="field mb-4">
				<label for="initialPrompt" class="block font-semibold mb-2"
					>Initial Prompt (Optional)</label
				>
				<textarea
					pTextarea
					id="initialPrompt"
					[(ngModel)]="initialPrompt"
					rows="3"
					class="w-full"
					placeholder="Optionally provide a starting prompt..."
				></textarea>
				<small class="text-color-secondary"
					>If provided, the first iteration will use this prompt
					instead of generating one from the brief.</small
				>
			</div>

			<!-- Judge Selection -->
			<div class="field mb-4">
				<label for="judges" class="block font-semibold mb-2"
					>Judges *</label
				>
				@if (loadingAgents()) {
				<p-skeleton width="100%" height="2.5rem" />
				} @else if (agents().length === 0) {
				<p-message severity="warn"
					>No judges available. Create judges first in the Judges
					section.</p-message
				>
				} @else {
				<p-multiselect
					id="judges"
					[options]="agents()"
					[(ngModel)]="selectedJudgeIds"
					optionLabel="name"
					optionValue="id"
					placeholder="Select judges to evaluate images"
					[showClear]="true"
					class="w-full"
					display="chip"
				/>
				}
			</div>

			<!-- Settings row -->
			<div class="flex gap-4 mb-4">
				<div class="field">
					<label for="maxIterations" class="block font-semibold mb-2"
						>Max Iterations</label
					>
					<p-inputNumber
						id="maxIterations"
						[(ngModel)]="maxIterations"
						[min]="1"
						[max]="50"
						[showButtons]="true"
					/>
				</div>
				<div class="field">
					<label for="threshold" class="block font-semibold mb-2"
						>Score Threshold (%)</label
					>
					<p-inputNumber
						id="threshold"
						[(ngModel)]="threshold"
						[min]="1"
						[max]="100"
						[showButtons]="true"
						suffix="%"
					/>
				</div>
			</div>

			<!-- Submit -->
			<div class="flex justify-content-end">
				<p-button
					label="Start Generation"
					icon="pi pi-play"
					(onClick)="onSubmit()"
					[loading]="submitting()"
					[disabled]="
						!brief.trim() || selectedJudgeIds.length === 0
					"
				/>
			</div>
		</div>
	</div>
</div>
