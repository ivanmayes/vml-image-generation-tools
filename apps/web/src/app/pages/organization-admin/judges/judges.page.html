<div class="judges-page">
	<h1 class="mb-4">Agents</h1>

	<p-toolbar styleClass="mb-4">
		<ng-template pTemplate="start">
			<p-iconfield iconPosition="left">
				<p-inputicon styleClass="pi pi-search"></p-inputicon>
				<input
					pInputText
					type="text"
					(input)="onSearch($event)"
					placeholder="Search agents..."
					class="w-80"
				/>
			</p-iconfield>
		</ng-template>
		<ng-template pTemplate="end">
			<button
				pButton
				label="Create Agent"
				icon="pi pi-plus"
				(click)="navigateToCreate()"
				aria-label="Create Agent"
			></button>
		</ng-template>
	</p-toolbar>

	<p-table
		[value]="loading() ? skeletonRows : agents()"
		[paginator]="true"
		[rows]="10"
		[showCurrentPageReport]="true"
		currentPageReportTemplate="Showing {first} to {last} of {totalRecords} agents"
		styleClass="p-datatable-striped"
		(onSort)="onSort($event)"
	>
		<ng-template pTemplate="header">
			<tr>
				<th [pSortableColumn]="'name'" class="cursor-pointer">
					Name <p-sortIcon [field]="'name'"></p-sortIcon>
				</th>
				<th>Status</th>
				<th>Type</th>
				<th>Can Judge</th>
				<th>Model</th>
				<th [pSortableColumn]="'createdAt'" class="cursor-pointer">
					Created <p-sortIcon [field]="'createdAt'"></p-sortIcon>
				</th>
				<th style="width: 150px">Actions</th>
			</tr>
		</ng-template>

		<ng-template pTemplate="body" let-agent>
			@if (!loading()) {
			<tr>
				<td>
					<button
						type="button"
						class="agent-name-link p-link"
						(click)="navigateToDetail(agent.id)"
					>
						{{ agent.name }}
					</button>
				</td>
				<td>
					<p-tag
						[value]="agent.status || 'ACTIVE'"
						[severity]="agent.status === 'INACTIVE' ? 'secondary' : 'success'"
					></p-tag>
				</td>
				<td>
					@if (agent.agentType) {
					<p-tag [value]="agent.agentType" severity="info"></p-tag>
					} @else {
					<span class="text-muted">-</span>
					}
				</td>
				<td>
					@if (agent.canJudge !== false) {
					<i
						class="pi pi-check"
						style="color: var(--p-green-500)"
					></i>
					} @else {
					<i
						class="pi pi-times"
						style="color: var(--p-text-color-secondary)"
					></i>
					}
				</td>
				<td>
					@if (agent.modelTier) { {{ agent.modelTier }} } @else {
					<span class="text-muted">-</span>
					}
				</td>
				<td>{{ formatDate(agent.createdAt) }}</td>
				<td>
					<div class="action-buttons">
						<button
							pButton
							icon="pi pi-pencil"
							class="p-button-rounded p-button-text p-button-sm"
							pTooltip="Edit Agent"
							aria-label="Edit Agent"
							(click)="navigateToDetail(agent.id)"
						></button>
						<button
							pButton
							icon="pi pi-trash"
							class="p-button-rounded p-button-text p-button-sm p-button-danger"
							pTooltip="Delete Agent"
							aria-label="Delete Agent"
							(click)="deleteAgent(agent)"
						></button>
					</div>
				</td>
			</tr>
			} @else {
			<tr>
				<td><p-skeleton /></td>
				<td><p-skeleton /></td>
				<td><p-skeleton /></td>
				<td><p-skeleton /></td>
				<td><p-skeleton /></td>
				<td><p-skeleton /></td>
				<td><p-skeleton /></td>
			</tr>
			}
		</ng-template>

		<ng-template pTemplate="emptymessage">
			<tr>
				<td colspan="7" class="text-center">
					<div class="empty-state">
						<i
							class="pi pi-inbox"
							style="
								font-size: 3rem;
								color: var(--text-color-secondary);
							"
						></i>
						<p>No agents found</p>
						<button
							pButton
							label="Create an Agent"
							icon="pi pi-plus"
							(click)="navigateToCreate()"
							aria-label="Create an Agent"
						></button>
					</div>
				</td>
			</tr>
		</ng-template>
	</p-table>
</div>

<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>
