<div class="users-page">
	<h1 class="mb-4">Space Users</h1>

	<p-toolbar styleClass="mb-4">
		<ng-template pTemplate="start">
			<p-iconfield iconPosition="left">
				<p-inputicon styleClass="pi pi-search"></p-inputicon>
				<input
					pInputText
					type="text"
					(input)="onSearch($event)"
					placeholder="Search users..."
					class="w-80"
				/>
			</p-iconfield>
		</ng-template>
		<ng-template pTemplate="end">
			<button
				pButton
				label="Invite User"
				icon="pi pi-user-plus"
				(click)="openInviteDialog()"
				aria-label="Invite User"
			></button>
		</ng-template>
	</p-toolbar>

	<p-table
		[value]="loading() ? skeletonRows : users()"
		[lazy]="true"
		[paginator]="true"
		[rows]="rowsPerPage"
		[totalRecords]="totalRecords()"
		(onLazyLoad)="onLazyLoad($event)"
		[rowsPerPageOptions]="[10, 25, 50]"
		[showCurrentPageReport]="true"
		currentPageReportTemplate="Showing {first} to {last} of {totalRecords} users"
		styleClass="p-datatable-striped"
	>
		<ng-template pTemplate="header">
			<tr>
				<th pSortableColumn="user.email">
					Email <p-sortIcon field="user.email"></p-sortIcon>
				</th>
				<th pSortableColumn="user.firstName">
					Name <p-sortIcon field="user.firstName"></p-sortIcon>
				</th>
				<th pSortableColumn="role">
					Role <p-sortIcon field="role"></p-sortIcon>
				</th>
				<th pSortableColumn="createdAt">
					Added <p-sortIcon field="createdAt"></p-sortIcon>
				</th>
				<th style="width: 150px">Actions</th>
			</tr>
		</ng-template>

		<ng-template pTemplate="body" let-user>
			@if (!loading()) {
			<tr>
				<td>{{ user.user?.email || 'N/A' }}</td>
				<td>
					@if (user.user?.firstName || user.user?.lastName) { {{
					user.user.firstName }} {{ user.user.lastName }} } @else { â€”
					}
				</td>
				<td>
					<p-badge
						[value]="getRoleLabel(user.role)"
						[severity]="getRoleBadgeSeverity(user.role)"
					></p-badge>
				</td>
				<td>{{ user.createdAt | date: 'MMM d, y' }}</td>
				<td>
					<div class="action-buttons">
						<button
							pButton
							icon="pi pi-user-edit"
							class="p-button-rounded p-button-text p-button-sm"
							pTooltip="Change Role"
							aria-label="Change Role"
							(click)="openChangeRoleDialog(user)"
						></button>
						<button
							pButton
							icon="pi pi-trash"
							class="p-button-rounded p-button-text p-button-sm p-button-danger"
							pTooltip="Remove User"
							aria-label="Remove User"
							(click)="onRemoveUser(user)"
						></button>
					</div>
				</td>
			</tr>
			} @else {
			<tr>
				<td><p-skeleton /></td>
				<td><p-skeleton /></td>
				<td><p-skeleton /></td>
				<td><p-skeleton /></td>
				<td><p-skeleton /></td>
			</tr>
			}
		</ng-template>

		<ng-template pTemplate="emptymessage">
			<tr>
				<td colspan="5" class="text-center">No users found</td>
			</tr>
		</ng-template>
	</p-table>
</div>

<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>
